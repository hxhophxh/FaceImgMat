# 📋 人脸数据管理功能说明

## ✨ 新增功能

在 **http://localhost:5000/import** 导入页面，右侧现在提供了完整的人脸数据管理功能：

### 1. 📊 可视化数据展示
- **网格布局**: 每个人员的所有照片以缩略图网格形式展示
- **图片预览**: 80x80 像素圆角缩略图，鼠标悬停显示删除按钮
- **统计信息**: 显示每个人员的照片数量和最后更新时间
- **人员计数**: 标题栏显示总人数

### 2. 🗑️ 删除功能

#### 删除单张图片
- **操作**: 鼠标悬停在图片上 → 点击红色删除图标
- **确认**: 弹出确认对话框
- **效果**: 
  - 立即从页面移除该图片
  - 更新照片数量徽章
  - 如果是最后一张照片，刷新页面移除人员卡片
  - 自动重建 FAISS 索引

#### 批量删除所有图片
- **操作**: 点击人员卡片右上角的垃圾桶按钮
- **确认**: 弹出确认对话框，显示将删除的照片数量
- **效果**: 
  - 删除该人员的所有照片
  - 从数据库中移除所有记录
  - 删除服务器上的实际文件
  - 刷新页面更新列表

### 3. ✏️ 编辑姓名功能

#### 编辑单个人员姓名
- **操作**: 点击人员卡片右上角的铅笔图标
- **界面**: 
  - 姓名文字转换为输入框
  - 显示保存(✓)和取消(✗)按钮
  - 输入框自动获取焦点并选中文字
- **保存**: 
  - 点击绿色保存按钮
  - 自动批量更新该人员的所有照片记录
  - 显示成功提示并刷新页面
- **取消**: 
  - 点击灰色取消按钮
  - 恢复原始姓名显示

#### 批量更新
- 修改姓名时，系统会自动更新该人员的 **所有** 照片记录
- 例如：将 "张三" 改为 "张三丰"，所有标记为 "张三" 的照片都会更新

## 🎯 使用场景

### 场景 1: 上传错误的图片
```
问题：不小心上传了错误的人脸照片
解决：鼠标悬停在错误照片上 → 点击删除 → 确认
```

### 场景 2: 姓名输入错误
```
问题：导入时将 "李四" 误输入为 "李思"
解决：点击编辑按钮 → 修改为 "李四" → 保存
结果：该人员的所有照片姓名都会更新
```

### 场景 3: 重复录入
```
问题：同一人的照片不小心录入了两次（不同姓名）
解决：
1. 保留正确姓名的记录
2. 将错误姓名的记录编辑为正确姓名
3. 系统会自动合并为一个人员
```

### 场景 4: 清理测试数据
```
问题：测试时导入了大量测试照片
解决：逐个点击垃圾桶按钮 → 批量删除所有照片
```

## 🎨 界面设计

### 布局结构
```
┌─────────────────────────────────────────────────┐
│ 👤 张三  [📝] [🗑️]                    3张照片  │
├─────────────────────────────────────────────────┤
│  [图1] [图2] [图3]  ← 鼠标悬停显示删除          │
│                                                 │
│  ⏰ 最后更新: 2025-10-07 14:30:00              │
└─────────────────────────────────────────────────┘
```

### 交互反馈
- ✅ **成功**: 绿色提示框，自动消失
- ❌ **失败**: 红色提示框，显示错误信息
- ⏳ **处理中**: 按钮禁用，显示加载图标
- 🔄 **刷新**: 操作成功后自动刷新页面

## 🔌 API 接口

### 1. 删除图片
```http
DELETE /persons/<person_id>
```

**响应**:
```json
{
  "success": true,
  "message": "删除成功"
}
```

### 2. 批量更新姓名
```http
PUT /persons/batch_update_name
Content-Type: application/json

{
  "old_name": "张三",
  "new_name": "张三丰"
}
```

**响应**:
```json
{
  "success": true,
  "message": "已将 3 条记录从 '张三' 改为 '张三丰'",
  "count": 3
}
```

### 3. 单个更新姓名
```http
PUT /persons/<person_id>/update_name
Content-Type: application/json

{
  "name": "新姓名"
}
```

**响应**:
```json
{
  "success": true,
  "message": "已将 '张三' 改为 '张三丰'",
  "old_name": "张三",
  "new_name": "张三丰"
}
```

## 🔒 安全特性

1. **身份认证**: 所有操作都需要管理员登录
2. **确认对话框**: 删除操作前需要二次确认
3. **文件清理**: 删除记录时同时删除服务器上的实际文件
4. **索引同步**: 删除后自动重建 FAISS 索引，保证搜索准确性
5. **错误处理**: 网络错误、服务器错误都有友好提示

## 🚀 性能优化

1. **懒加载**: 图片按需加载
2. **即时更新**: 删除单张图片时无需刷新整个页面
3. **批量操作**: 批量删除使用异步并发处理
4. **缓存管理**: 删除后清理浏览器缓存

## 📱 响应式设计

- **桌面端**: 左右分栏布局，图片网格自适应
- **平板端**: 自动调整图片大小
- **移动端**: 单栏布局，图片网格 2-3 列

## 🐛 常见问题

### Q: 删除图片后页面没有更新？
A: 刷新浏览器或等待 1 秒后自动刷新

### Q: 修改姓名后为什么会影响多张照片？
A: 这是批量更新功能，会更新该人员的所有照片记录

### Q: 删除失败怎么办？
A: 检查：
1. 是否有管理员权限
2. 文件是否被占用
3. 磁盘空间是否充足
4. 查看浏览器控制台的详细错误信息

### Q: 可以撤销删除操作吗？
A: 不可以，删除是永久性的。建议操作前做好数据备份。

## 📝 使用提示

1. **定期清理**: 定期删除质量不好的照片
2. **统一命名**: 使用规范的姓名格式
3. **批量导入**: 同一人的多张照片一次性导入（使用相同姓名）
4. **测试验证**: 导入后在匹配页面测试效果
5. **备份数据**: 重要操作前备份数据库

## 🎉 功能亮点

- ✅ **直观可视化**: 所有数据一目了然
- ✅ **操作简单**: 点击即可完成操作
- ✅ **即时反馈**: 立即看到操作结果
- ✅ **批量处理**: 支持批量删除和更新
- ✅ **数据一致性**: 自动同步数据库和索引
- ✅ **安全可靠**: 多重确认，防止误操作

---

**现在访问 http://localhost:5000/import 体验全新的数据管理功能！** 🚀
