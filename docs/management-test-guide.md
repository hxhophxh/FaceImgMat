# 🧪 人脸数据管理功能 - 快速测试指南

## 准备工作

1. **确保应用正在运行**
   ```powershell
   # 如果没有运行，执行：
   python run.py
   ```

2. **访问导入页面**
   打开浏览器访问: http://localhost:5000/import

3. **登录系统**
   - 用户名: `admin`
   - 密码: `admin123`

## 测试清单

### ✅ 测试 1: 查看现有数据
**期望结果**:
- 右侧显示所有已导入的人员
- 每个人员显示照片网格
- 显示照片数量徽章
- 显示最后更新时间

**检查项目**:
- [ ] 能看到所有人员卡片
- [ ] 图片正常显示（不是占位符）
- [ ] 照片数量正确
- [ ] 界面美观，无错位

---

### ✅ 测试 2: 删除单张图片
**操作步骤**:
1. 鼠标悬停在任意一张照片上
2. 红色删除按钮应该出现
3. 点击删除按钮
4. 在确认对话框中点击"确定"

**期望结果**:
- [ ] 悬停时显示红色删除覆盖层
- [ ] 弹出确认对话框
- [ ] 点击确定后图片立即消失
- [ ] 照片数量徽章自动减 1
- [ ] 显示成功提示 "✅ 删除成功"

---

### ✅ 测试 3: 编辑人员姓名
**操作步骤**:
1. 找到任意一个人员卡片
2. 点击右上角的铅笔图标 📝
3. 输入框出现并自动获取焦点
4. 修改姓名（例如：张三 → 张三丰）
5. 点击绿色保存按钮 ✓

**期望结果**:
- [ ] 点击编辑后，姓名变为输入框
- [ ] 输入框文字自动选中
- [ ] 可以正常输入新姓名
- [ ] 点击保存后显示 "✅ 已将 X 条记录..."
- [ ] 1 秒后页面自动刷新
- [ ] 刷新后姓名已更新

---

### ✅ 测试 4: 取消编辑
**操作步骤**:
1. 点击铅笔图标编辑姓名
2. 修改输入框中的文字
3. 点击灰色取消按钮 ✗

**期望结果**:
- [ ] 输入框消失
- [ ] 恢复原始姓名显示
- [ ] 修改未保存

---

### ✅ 测试 5: 批量删除所有照片
**操作步骤**:
1. 找到一个人员卡片
2. 点击右上角的垃圾桶图标 🗑️
3. 确认对话框显示将删除的照片数量
4. 点击"确定"

**期望结果**:
- [ ] 弹出确认对话框，显示照片数量
- [ ] 对话框提示 "此操作不可恢复！"
- [ ] 点击确定后逐个删除图片
- [ ] 显示成功提示
- [ ] 1 秒后页面自动刷新
- [ ] 该人员卡片已消失

---

### ✅ 测试 6: 错误处理
**测试 6.1: 姓名为空**
1. 编辑姓名，清空输入框
2. 点击保存

**期望结果**:
- [ ] 弹出 "姓名不能为空" 提示

**测试 6.2: 网络错误模拟**
1. 在浏览器开发者工具中 Network 选项卡设置为 Offline
2. 尝试删除图片

**期望结果**:
- [ ] 显示 "❌ 网络错误..." 提示

---

### ✅ 测试 7: 界面交互
**鼠标悬停效果**:
- [ ] 悬停人员卡片，卡片轻微上浮
- [ ] 悬停图片，显示红色删除覆盖层
- [ ] 悬停按钮，按钮颜色变化

**响应式布局**:
- [ ] 缩小浏览器窗口，图片网格自动调整
- [ ] 在不同屏幕尺寸下布局正常

---

### ✅ 测试 8: 批量操作
**场景: 修改同名人员**
1. 导入多张照片，使用相同姓名（如 "测试人员"）
2. 编辑其中一个 "测试人员" 的姓名
3. 改为 "正式人员"
4. 保存

**期望结果**:
- [ ] 所有 "测试人员" 的照片都改为 "正式人员"
- [ ] 成功提示显示更新的记录数
- [ ] 刷新后只有 "正式人员" 卡片，无 "测试人员"

---

### ✅ 测试 9: 数据一致性
**操作步骤**:
1. 在导入页面删除一张图片
2. 切换到匹配页面 (http://localhost:5000/match)
3. 上传图片进行匹配

**期望结果**:
- [ ] 已删除的图片不会出现在匹配结果中
- [ ] FAISS 索引已自动更新

---

### ✅ 测试 10: 边界情况

**测试 10.1: 删除最后一张照片**
1. 找到只有 1 张照片的人员
2. 删除这张照片

**期望结果**:
- [ ] 页面自动刷新
- [ ] 该人员卡片完全消失

**测试 10.2: 空数据状态**
1. 删除所有人员的所有照片
2. 查看右侧区域

**期望结果**:
- [ ] 显示 "暂无数据" 提示
- [ ] 显示 "请从左侧导入人脸数据" 说明

**测试 10.3: 相同姓名合并**
1. 有一个人员叫 "张三"（2张照片）
2. 有另一个人员叫 "李四"（3张照片）
3. 将 "李四" 改名为 "张三"

**期望结果**:
- [ ] 刷新后 "李四" 卡片消失
- [ ] "张三" 卡片现在显示 5 张照片

---

## 🎯 性能测试

### 测试场景: 批量删除多张图片
**准备**:
- 创建一个人员，导入 10+ 张照片

**操作**:
1. 点击批量删除按钮
2. 确认删除

**观察**:
- [ ] 删除过程流畅，无卡顿
- [ ] 成功提示显示正确的删除数量
- [ ] 1 秒内完成所有删除操作

---

## 🐛 已知问题检查

- [ ] 图片路径正确（不是占位符）
- [ ] 中文姓名显示正常（无乱码）
- [ ] 删除操作后 FAISS 索引正常工作
- [ ] 编辑姓名后数据库更新正确
- [ ] 按钮点击后正确禁用，防止重复提交

---

## 📊 测试结果记录

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 查看现有数据 | ⬜ |  |
| 删除单张图片 | ⬜ |  |
| 编辑人员姓名 | ⬜ |  |
| 取消编辑 | ⬜ |  |
| 批量删除 | ⬜ |  |
| 错误处理 | ⬜ |  |
| 界面交互 | ⬜ |  |
| 批量操作 | ⬜ |  |
| 数据一致性 | ⬜ |  |
| 边界情况 | ⬜ |  |

---

## 🚀 快速测试命令

如果需要快速添加测试数据：

```python
# 在 Python 终端中运行
from app import create_app
from app.models import db, Person
from app.face_matcher import face_matcher
import os

app = create_app()
with app.app_context():
    # 检查当前数据
    print(f"当前人员数: {Person.query.count()}")
    
    # 查看所有人员
    for p in Person.query.all():
        print(f"ID:{p.id} - {p.name}")
```

---

**测试完成后，请在每个测试项前打 ✅，并记录任何问题！**
