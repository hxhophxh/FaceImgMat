# 📦 如何获取 `一键完整部署.bat` 所需的依赖文件

## 🎯 问题说明

`user-package\一键完整部署.bat` 执行时需要以下依赖：

1. ✅ **Python 3.12.7 安装程序** (~26MB)
2. ✅ **项目源码** (FaceImgMat)
3. ✅ **所有 Python 依赖包** (~500MB, 100+ 个包)
4. ✅ **InsightFace AI 模型** (~200MB)

---

## 🚀 解决方案：两种获取方式

### 方式一：使用 `准备超级离线包.bat`（推荐）⭐

**适用场景**：在有网络的机器上准备完整离线包

#### 操作步骤：

```powershell
# 1. 进入 super-offline-deployment 目录
cd D:\test\FaceImgMat\super-offline-deployment

# 2. 双击运行（或命令行运行）
.\准备超级离线包.bat
```

#### 这个脚本会自动完成：

```
[步骤 1/6] 创建目录结构
    ├── 01-Python安装包/
    ├── 02-项目源码/
    ├── 03-Python依赖包/
    └── 04-AI模型文件/

[步骤 2/6] 下载 Python 3.12.7 安装程序 (~26MB)
    从 https://www.python.org/ftp/python/3.12.7/
    
[步骤 3/6] 复制项目源码
    从当前项目目录复制到 02-项目源码/FaceImgMat/
    
[步骤 4/6] 下载 Python 依赖包 (~500MB，100+ 个包)
    从清华大学 PyPI 镜像下载
    使用 requirements.txt
    
[步骤 5/6] 复制 InsightFace 模型
    从 %USERPROFILE%\.insightface\models
    
[步骤 6/6] 验证完整性
    检查所有文件是否齐全
```

#### 预计时间：
- ⏱️ **15-25 分钟**（取决于网速）
- 💾 **约 2GB** 磁盘空间

---

### 方式二：使用 `prepare-super-offline.bat`（英文版）

**功能完全相同**，只是界面是英文的：

```powershell
cd D:\test\FaceImgMat\super-offline-deployment
.\prepare-super-offline.bat
```

---

## 📂 准备完成后的目录结构

```
super-offline-deployment/
├── 01-Python安装包/
│   ├── python-3.12.7-amd64.exe        ← Python 安装程序
│   └── 安装Python说明.txt
│
├── 02-项目源码/
│   └── FaceImgMat/                     ← 完整项目代码
│       ├── app/
│       ├── static/
│       ├── templates/
│       ├── run.py
│       ├── requirements.txt
│       └── ...
│
├── 03-Python依赖包/
│   ├── Flask-3.0.0-py3-none-any.whl   ← 100+ 个 .whl 包
│   ├── insightface-0.7.3-py3-none-any.whl
│   ├── opencv_python-4.10.0-cp312-cp312-win_amd64.whl
│   └── ...
│
├── 04-AI模型文件/
│   └── insightface_models/             ← AI 模型
│       ├── buffalo_l/
│       ├── antelopev2/
│       └── ...
│
├── 一键完整部署.bat                    ⭐ 在目标机器运行这个
├── 准备超级离线包.bat                  ⭐ 在有网机器运行这个
└── README-USER.md
```

---

## 🔄 完整工作流程

### 在开发机器（有网络）：

```
第1步: 运行准备脚本
    .\准备超级离线包.bat
    ↓
    等待 15-25 分钟（自动下载所有依赖）
    ↓
第2步: 压缩整个目录
    Compress-Archive -Path "super-offline-deployment" `
                     -DestinationPath "FaceImgMat-超级离线包.zip"
    ↓
第3步: 传输到目标机器
    通过 U盘/网络/邮件 等方式
```

### 在目标机器（可以无网络）：

```
第1步: 解压离线包
    解压 FaceImgMat-超级离线包.zip
    ↓
第2步: 运行部署脚本
    双击 一键完整部署.bat
    ↓
    等待 15-20 分钟（全自动安装）
    ↓
第3步: 访问系统
    http://127.0.0.1:5000
    账号: admin
    密码: Admin@FaceMatch2025!
```

---

## 💡 常见问题

### Q1: 为什么 `user-package` 中的 `一键完整部署.bat` 不能直接用？

**A:** 因为 `user-package` 只包含脚本文件（轻量级），不包含依赖。需要：
- 要么在目标机器联网下载
- 要么先用 `准备超级离线包.bat` 准备完整包

### Q2: `准备超级离线包.bat` 和 `prepare-super-offline.bat` 有什么区别？

**A:** 功能完全相同，只是：
- `准备超级离线包.bat` - 中文界面
- `prepare-super-offline.bat` - 英文界面

### Q3: 如果下载失败怎么办？

**A:** 可以重复运行脚本，已下载的文件会被跳过或覆盖。

### Q4: Python 版本可以改吗？

**A:** 可以，需要修改 `prepare-super-package.ps1` 中的版本号和下载链接。

### Q5: 能在 Linux 上用吗？

**A:** 不能。这个是 Windows 专用包。Linux 请参考 `docs/LINUX-DEPLOYMENT.md`

---

## 🛠️ 手动准备（高级用户）

如果自动脚本失败，可以手动准备：

```powershell
# 1. 下载 Python
# 访问 https://www.python.org/downloads/
# 下载 python-3.12.7-amd64.exe
# 放到 01-Python安装包/

# 2. 复制项目源码
robocopy D:\test\FaceImgMat 02-项目源码\FaceImgMat /E /XD .git .venv __pycache__

# 3. 下载依赖包
cd 02-项目源码\FaceImgMat
python -m pip download -r requirements.txt `
    -d ..\..\03-Python依赖包 `
    -i https://pypi.tuna.tsinghua.edu.cn/simple `
    --python-version 3.12 `
    --only-binary=:all:

# 4. 复制模型（如果有）
xcopy "%USERPROFILE%\.insightface\models" "04-AI模型文件\insightface_models" /E /I /Y
```

---

## 📊 文件大小参考

| 组件 | 大小 | 说明 |
|------|------|------|
| Python 安装程序 | ~26MB | python-3.12.7-amd64.exe |
| 项目源码 | ~5MB | 不含 .git, .venv |
| Python 依赖包 | ~500MB | 100+ 个 .whl 文件 |
| AI 模型 | ~200MB | InsightFace 模型 |
| **总计** | **~730MB** | 压缩后约 500MB |

---

## ✅ 验证离线包完整性

运行准备脚本后，检查：

```powershell
# 检查目录结构
cd super-offline-deployment
dir /s /b

# 应该看到：
✓ 01-Python安装包\python-3.12.7-amd64.exe
✓ 02-项目源码\FaceImgMat\run.py
✓ 03-Python依赖包\*.whl (100+ 个文件)
✓ 04-AI模型文件\insightface_models\ (有子目录)
✓ 一键完整部署.bat
```

---

## 🎉 总结

**最简单的方法**：

1. 在有网络的机器上运行 `准备超级离线包.bat`
2. 等待 15-25 分钟
3. 压缩整个 `super-offline-deployment` 文件夹
4. 传输到目标机器
5. 在目标机器运行 `一键完整部署.bat`

**就这么简单！** 🚀

---

## 📞 需要帮助？

如果遇到问题，检查：
- 是否有足够磁盘空间（至少 5GB）
- 是否有网络连接（准备阶段）
- 防火墙/杀毒软件是否拦截
- 查看错误日志

更多信息请参考：
- `README-USER.md` - 用户使用指南
- `DEPLOYMENT-GUIDE.md` - 详细部署文档
- `用户使用说明.txt` - 图文操作手册
